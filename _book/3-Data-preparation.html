<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Reza Mohammadi">
<title>3&nbsp; Data Preparation in Practice: Turning Raw Data into Insight – Data Science Foundations and Machine Learning with R: From Data to Decisions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./4-Exploratory-data-analysis.html" rel="next">
<link href="./2-Intro-data-science.html" rel="prev">
<link href="./images/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-37b910d383d25f91074a86a846b870e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./3-Data-preparation.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Preparation in Practice: Turning Raw Data into Insight</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science Foundations and Machine Learning with R: From Data to Decisions</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/RezaMoammadi/Book-Data-Science" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Data-Science-Foundations-and-Machine-Learning-with-R--From-Data-to-Decisions.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="./Data-Science-Foundations-and-Machine-Learning-with-R--From-Data-to-Decisions.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
</div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0-preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-Intro-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-Intro-data-science.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Foundations of Data Science and Machine Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-Data-preparation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Preparation in Practice: Turning Raw Data into Insight</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4-Exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5-Statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Statistical Inference and Hypothesis Testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6-Setup-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Setting Up Data for Modeling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7-Classification-kNN.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Classification Using k-Nearest Neighbors</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8-Model-evaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Evaluating Machine Learning Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9-Naive-Bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Naive Bayes Classifier</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Regression Analysis: Foundations and Applications</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-Tree-based-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Decision Trees and Random Forests</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Neural-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Neural Networks: The Building Blocks of Artificial Intelligence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Clustering for Insight: Segmenting Data Without Labels</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-References.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#what-this-chapter-covers" id="toc-what-this-chapter-covers" class="nav-link active" data-scroll-target="#what-this-chapter-covers">What This Chapter Covers</a></li>
  <li>
<a href="#sec-ch3-problem-understanding" id="toc-sec-ch3-problem-understanding" class="nav-link" data-scroll-target="#sec-ch3-problem-understanding"><span class="header-section-number">3.1</span> Data Preparation in Action: The <em>diamonds</em> Dataset</a>
  <ul class="collapse">
<li><a href="#loading-and-exploring-the-diamonds-dataset" id="toc-loading-and-exploring-the-diamonds-dataset" class="nav-link" data-scroll-target="#loading-and-exploring-the-diamonds-dataset">Loading and Exploring the <em>diamonds</em> Dataset</a></li>
  </ul>
</li>
  <li><a href="#identifying-feature-types" id="toc-identifying-feature-types" class="nav-link" data-scroll-target="#identifying-feature-types"><span class="header-section-number">3.2</span> Identifying Feature Types</a></li>
  <li><a href="#key-considerations-for-data-preparation" id="toc-key-considerations-for-data-preparation" class="nav-link" data-scroll-target="#key-considerations-for-data-preparation"><span class="header-section-number">3.3</span> Key Considerations for Data Preparation</a></li>
  <li><a href="#sec-ch3-data-pre-outliers" id="toc-sec-ch3-data-pre-outliers" class="nav-link" data-scroll-target="#sec-ch3-data-pre-outliers"><span class="header-section-number">3.4</span> Outliers: What They Are and Why They Matter</a></li>
  <li>
<a href="#spotting-outliers-with-visual-tools" id="toc-spotting-outliers-with-visual-tools" class="nav-link" data-scroll-target="#spotting-outliers-with-visual-tools"><span class="header-section-number">3.5</span> Spotting Outliers with Visual Tools</a>
  <ul class="collapse">
<li><a href="#boxplots-visualizing-and-flagging-outliers" id="toc-boxplots-visualizing-and-flagging-outliers" class="nav-link" data-scroll-target="#boxplots-visualizing-and-flagging-outliers">Boxplots: Visualizing and Flagging Outliers</a></li>
  <li><a href="#histograms-revealing-outlier-patterns" id="toc-histograms-revealing-outlier-patterns" class="nav-link" data-scroll-target="#histograms-revealing-outlier-patterns">Histograms: Revealing Outlier Patterns</a></li>
  <li><a href="#additional-tools-for-visual-outlier-detection" id="toc-additional-tools-for-visual-outlier-detection" class="nav-link" data-scroll-target="#additional-tools-for-visual-outlier-detection">Additional Tools for Visual Outlier Detection</a></li>
  </ul>
</li>
  <li><a href="#sec-ch3-handle-outliers" id="toc-sec-ch3-handle-outliers" class="nav-link" data-scroll-target="#sec-ch3-handle-outliers"><span class="header-section-number">3.6</span> How to Handle Outliers</a></li>
  <li><a href="#outlier-treatment-in-action" id="toc-outlier-treatment-in-action" class="nav-link" data-scroll-target="#outlier-treatment-in-action"><span class="header-section-number">3.7</span> Outlier Treatment in Action</a></li>
  <li><a href="#sec-ch3-missing-values" id="toc-sec-ch3-missing-values" class="nav-link" data-scroll-target="#sec-ch3-missing-values"><span class="header-section-number">3.8</span> Missing Values: What They Are and Why They Matter</a></li>
  <li>
<a href="#imputation-techniques" id="toc-imputation-techniques" class="nav-link" data-scroll-target="#imputation-techniques"><span class="header-section-number">3.9</span> Imputation Techniques</a>
  <ul class="collapse">
<li><a href="#example-random-sampling-imputation-in-r" id="toc-example-random-sampling-imputation-in-r" class="nav-link" data-scroll-target="#example-random-sampling-imputation-in-r">Example: Random Sampling Imputation in R</a></li>
  <li><a href="#alternative-approaches" id="toc-alternative-approaches" class="nav-link" data-scroll-target="#alternative-approaches">Alternative Approaches</a></li>
  </ul>
</li>
  <li><a href="#sec-ch3-feature-scaling" id="toc-sec-ch3-feature-scaling" class="nav-link" data-scroll-target="#sec-ch3-feature-scaling"><span class="header-section-number">3.10</span> Feature Scaling</a></li>
  <li><a href="#min-max-scaling" id="toc-min-max-scaling" class="nav-link" data-scroll-target="#min-max-scaling"><span class="header-section-number">3.11</span> Min-Max Scaling</a></li>
  <li><a href="#z-score-scaling" id="toc-z-score-scaling" class="nav-link" data-scroll-target="#z-score-scaling"><span class="header-section-number">3.12</span> Z-score Scaling</a></li>
  <li><a href="#sec-ch3-encoding" id="toc-sec-ch3-encoding" class="nav-link" data-scroll-target="#sec-ch3-encoding"><span class="header-section-number">3.13</span> Encoding Categorical Features for Modeling</a></li>
  <li><a href="#sec-ch3-ordinal-encoding" id="toc-sec-ch3-ordinal-encoding" class="nav-link" data-scroll-target="#sec-ch3-ordinal-encoding"><span class="header-section-number">3.14</span> Ordinal Encoding</a></li>
  <li>
<a href="#sec-ch3-one-hot-encoding" id="toc-sec-ch3-one-hot-encoding" class="nav-link" data-scroll-target="#sec-ch3-one-hot-encoding"><span class="header-section-number">3.15</span> One-Hot Encoding</a>
  <ul class="collapse">
<li><a href="#one-hot-encoding-in-r" id="toc-one-hot-encoding-in-r" class="nav-link" data-scroll-target="#one-hot-encoding-in-r"><span class="header-section-number">3.15.1</span> One-Hot Encoding in R</a></li>
  </ul>
</li>
  <li>
<a href="#sec-ch3-data-pre-adult" id="toc-sec-ch3-data-pre-adult" class="nav-link" data-scroll-target="#sec-ch3-data-pre-adult"><span class="header-section-number">3.16</span> Case Study: Preparing Data to Predict High Earners</a>
  <ul class="collapse">
<li><a href="#overview-of-the-dataset" id="toc-overview-of-the-dataset" class="nav-link" data-scroll-target="#overview-of-the-dataset"><span class="header-section-number">3.16.1</span> Overview of the Dataset</a></li>
  <li><a href="#handling-missing-values" id="toc-handling-missing-values" class="nav-link" data-scroll-target="#handling-missing-values"><span class="header-section-number">3.16.2</span> Handling Missing Values</a></li>
  <li><a href="#encoding-categorical-variables" id="toc-encoding-categorical-variables" class="nav-link" data-scroll-target="#encoding-categorical-variables"><span class="header-section-number">3.16.3</span> Encoding Categorical Variables</a></li>
  <li><a href="#handling-outliers" id="toc-handling-outliers" class="nav-link" data-scroll-target="#handling-outliers"><span class="header-section-number">3.16.4</span> Handling Outliers</a></li>
  </ul>
</li>
  <li><a href="#chapter-summary-and-takeaways" id="toc-chapter-summary-and-takeaways" class="nav-link" data-scroll-target="#chapter-summary-and-takeaways"><span class="header-section-number">3.17</span> Chapter Summary and Takeaways</a></li>
  <li>
<a href="#sec-ch3-exercises" id="toc-sec-ch3-exercises" class="nav-link" data-scroll-target="#sec-ch3-exercises"><span class="header-section-number">3.18</span> Exercises</a>
  <ul class="collapse">
<li><a href="#understanding-data-types" id="toc-understanding-data-types" class="nav-link" data-scroll-target="#understanding-data-types">Understanding Data Types</a></li>
  <li><a href="#working-with-the-diamonds-dataset" id="toc-working-with-the-diamonds-dataset" class="nav-link" data-scroll-target="#working-with-the-diamonds-dataset">Working with the Diamonds Dataset</a></li>
  <li><a href="#detecting-and-treating-outliers" id="toc-detecting-and-treating-outliers" class="nav-link" data-scroll-target="#detecting-and-treating-outliers">Detecting and Treating Outliers</a></li>
  <li><a href="#encoding-categorical-variables-1" id="toc-encoding-categorical-variables-1" class="nav-link" data-scroll-target="#encoding-categorical-variables-1">Encoding Categorical Variables</a></li>
  <li><a href="#exploring-the-adult-dataset" id="toc-exploring-the-adult-dataset" class="nav-link" data-scroll-target="#exploring-the-adult-dataset">Exploring the Adult Dataset</a></li>
  <li><a href="#feature-engineering-and-scaling" id="toc-feature-engineering-and-scaling" class="nav-link" data-scroll-target="#feature-engineering-and-scaling">Feature Engineering and Scaling</a></li>
  <li><a href="#modeling-and-real-world-scenarios" id="toc-modeling-and-real-world-scenarios" class="nav-link" data-scroll-target="#modeling-and-real-world-scenarios">Modeling and Real-World Scenarios</a></li>
  <li><a href="#ethics-and-reflection" id="toc-ethics-and-reflection" class="nav-link" data-scroll-target="#ethics-and-reflection">Ethics and Reflection</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/RezaMoammadi/Book-Data-Science/edit/main/3-Data-preparation.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/RezaMoammadi/Book-Data-Science/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-ch3-data-preparation" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Preparation in Practice: Turning Raw Data into Insight</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>You have just been handed a spreadsheet with hundreds of columns and thousands of rows—missing entries, inconsistent labels, strange codes like <code>-999</code>, and values that make no sense. How do you begin to turn this chaos into insight?</p>
<p>In this chapter, we explore one of the most underestimated yet indispensable stages in the Data Science Workflow: <em>data preparation</em>. No matter how sophisticated your algorithm, the quality of your data will ultimately shape the trustworthiness of your results. It is often said that data scientists spend <em>up to 80% of their time</em> preparing data, and with good reason.</p>
<p>In real-world settings, data rarely arrives in a clean, analysis-ready format. Instead, it often includes missing values, outliers, inconsistent entries, and a mix of numerical and categorical variables. Preparing such data means more than just “cleaning”; it involves thoughtful transformation, encoding, and restructuring to support both exploration and modeling.</p>
<p>By contrast, datasets found on platforms like <a href="https://www.kaggle.com">Kaggle</a> are typically curated and neatly labeled, often with a clear target variable and well-posed questions. These are excellent for learning, but they can give a misleading impression of what real data science work entails. In practice, data is collected for operational, not analytical, purposes, and significant effort is required to make it useful for decision-making.</p>
<p>To bring data preparation techniques to life, we begin with the <em>diamonds</em> dataset from the <strong>ggplot2</strong> package, a structured and relatively clean dataset that allows us to practice foundational skills. Later in the chapter, we shift to the <em>adult</em> income dataset, where we apply the same techniques to a more realistic, messier context.</p>
<p>Although this chapter focuses on data preparation, many of the steps, such as detecting outliers, handling missing values, and transforming variables, overlap with <em>exploratory data analysis</em> (Chapter <a href="4-Exploratory-data-analysis.html" class="quarto-xref"><span>4</span></a>) and <em>data setup for modeling</em> (Chapter <a href="6-Setup-data.html" class="quarto-xref"><span>6</span></a>). These stages are often revisited in practice, reflecting the iterative nature of the Data Science Workflow.</p>
<p>With a clear understanding of the problem and its connection to the available data, we now move to the next step: preparing the dataset for analysis. This step builds the foundation for meaningful insights and reliable machine learning models, transforming raw information into structured knowledge.</p>
<section id="what-this-chapter-covers" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="what-this-chapter-covers">What This Chapter Covers</h3>
<p>This chapter introduces the essential techniques for transforming raw data into a format suitable for analysis and modeling. You will learn how to:</p>
<ul>
<li><p>Spot and manage outliers using visualization and filtering to reduce distortion,</p></li>
<li><p>Detect and impute missing values to preserve data quality and completeness,</p></li>
<li><p>Scale numerical features using Min-Max and Z-score methods to ensure comparability,</p></li>
<li><p>Encode categorical variables through ordinal, one-hot, and frequency encoding for use in machine learning algorithms.</p></li>
</ul>
<p>To ground these techniques, we begin by clarifying the analytical goals of our first dataset, the <em>diamonds</em> dataset, and frame the task of price estimation as a data science problem. The chapter concludes with a hands-on case study using the <em>adult</em> income dataset, where you will apply the full data preparation pipeline in a more complex, real-world setting. Together, these skills form a crucial step in the Data Science Workflow and prepare you to build models with clean, structured, and meaningful data.</p>
</section><section id="sec-ch3-problem-understanding" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="sec-ch3-problem-understanding">
<span class="header-section-number">3.1</span> Data Preparation in Action: The <em>diamonds</em> Dataset</h2>
<p>How can we quantify the value of a diamond? What determines why two stones that appear nearly identical fetch vastly different prices? In this section, we bring the concepts of data preparation to life using the <em>diamonds</em> dataset, a rich, structured collection of gem attributes from the <strong>ggplot2</strong> package. It serves as our testing ground for exploring how to clean, transform, and organize data in ways that reveal meaningful insights.</p>
<p>Our central goal is to understand how features such as carat, cut, color, and clarity contribute to price variation. But before we begin processing the data, we must first frame the business problem and identify the analytical questions it raises. Data preparation is not merely technical; it is purposeful.</p>
<p>We focus on three guiding questions: which features have the strongest influence on diamond price; whether consistent pricing patterns emerge based on attributes like carat weight or cut quality; and whether the dataset contains anomalies, such as outliers or inconsistent entries, that must be addressed before modeling.</p>
<p>From a business perspective, answering these questions supports smarter pricing and inventory strategies for jewelers and online retailers. From a data science perspective, it ensures that our preprocessing choices, such as filtering outliers or encoding variables, are aligned with the real-world task at hand. This alignment between domain understanding and technical preparation is what makes data preparation both effective and impactful.</p>
<p>Later in the book, we will return to this dataset in Chapter <a href="10-Regression.html" class="quarto-xref"><span>10</span></a>, where we use the features prepared here to build a predictive regression model, completing the journey from raw data to actionable insight.</p>
<section id="loading-and-exploring-the-diamonds-dataset" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="loading-and-exploring-the-diamonds-dataset">Loading and Exploring the <em>diamonds</em> Dataset</h3>
<p>With a clear understanding of the problem and the analytical goals, we are ready to begin working directly with the data. The first step in data preparation is to load the dataset and explore its structure to identify what needs to be cleaned, transformed, or encoded.</p>
<p>We use the <em>diamonds</em> dataset from the <strong>ggplot2</strong> package, a structured collection of gem characteristics such as carat weight, cut, color, clarity, and price. This dataset serves as a clean but realistic foundation for practicing core data preparation techniques.</p>
<p>The dataset includes over 50,000 rows, with each observation representing a unique diamond. It provides 10 variables describing physical attributes and quality ratings. To follow along in R, make sure the <strong>ggplot2</strong> package is installed. If it is not yet installed, install it with <code>install.packages("ggplot2")</code>. Then load the package and access the dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>    <span class="co"># Load ggplot2 package</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>      <span class="co"># Load the diamonds dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get a sense of the dataset’s structure, use the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(diamonds)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>   tibble [<span class="dv">53</span>,<span class="dv">940</span> × <span class="dv">10</span>] (S3<span class="sc">:</span> tbl_df<span class="sc">/</span>tbl<span class="sc">/</span>data.frame)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> carat  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">0.23</span> <span class="fl">0.21</span> <span class="fl">0.23</span> <span class="fl">0.29</span> <span class="fl">0.31</span> <span class="fl">0.24</span> <span class="fl">0.24</span> <span class="fl">0.26</span> <span class="fl">0.22</span> <span class="fl">0.23</span> ...</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> cut    <span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">"Fair"</span><span class="sc">&lt;</span><span class="st">"Good"</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">3</span> ...</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> color  <span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">7</span> levels <span class="st">"D"</span><span class="sc">&lt;</span><span class="st">"E"</span><span class="sc">&lt;</span><span class="st">"F"</span><span class="sc">&lt;</span><span class="st">"G"</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">6</span> <span class="dv">5</span> <span class="dv">2</span> <span class="dv">5</span> ...</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> clarity<span class="sc">:</span> Ord.factor w<span class="sc">/</span> <span class="dv">8</span> levels <span class="st">"I1"</span><span class="sc">&lt;</span><span class="st">"SI2"</span><span class="sc">&lt;</span><span class="st">"SI1"</span><span class="sc">&lt;</span>..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> ...</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> depth  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">61.5</span> <span class="fl">59.8</span> <span class="fl">56.9</span> <span class="fl">62.4</span> <span class="fl">63.3</span> <span class="fl">62.8</span> <span class="fl">62.3</span> <span class="fl">61.9</span> <span class="fl">65.1</span> <span class="fl">59.4</span> ...</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> table  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="dv">55</span> <span class="dv">61</span> <span class="dv">65</span> <span class="dv">58</span> <span class="dv">58</span> <span class="dv">57</span> <span class="dv">57</span> <span class="dv">55</span> <span class="dv">61</span> <span class="dv">61</span> ...</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> price  <span class="sc">:</span> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="dv">326</span> <span class="dv">326</span> <span class="dv">327</span> <span class="dv">334</span> <span class="dv">335</span> <span class="dv">336</span> <span class="dv">336</span> <span class="dv">337</span> <span class="dv">337</span> <span class="dv">338</span> ...</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> x      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">3.95</span> <span class="fl">3.89</span> <span class="fl">4.05</span> <span class="fl">4.2</span> <span class="fl">4.34</span> <span class="fl">3.94</span> <span class="fl">3.95</span> <span class="fl">4.07</span> <span class="fl">3.87</span> <span class="dv">4</span> ...</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> y      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">3.98</span> <span class="fl">3.84</span> <span class="fl">4.07</span> <span class="fl">4.23</span> <span class="fl">4.35</span> <span class="fl">3.96</span> <span class="fl">3.98</span> <span class="fl">4.11</span> <span class="fl">3.78</span> <span class="fl">4.05</span> ...</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> z      <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">53940</span>] <span class="fl">2.43</span> <span class="fl">2.31</span> <span class="fl">2.31</span> <span class="fl">2.63</span> <span class="fl">2.75</span> <span class="fl">2.48</span> <span class="fl">2.47</span> <span class="fl">2.53</span> <span class="fl">2.49</span> <span class="fl">2.39</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This command reveals the number of observations and variables, along with data types and sample values. The dataset includes numerical features such as <code>carat</code> (weight), <code>price</code>, and physical dimensions (<code>x</code>, <code>y</code>, <code>z</code>), as well as categorical attributes like <code>cut</code> (quality of cut), <code>color</code> (ranging from D to J), and <code>clarity</code> (from I1 to IF). These features are central to the modeling task we will revisit in Chapter <a href="10-Regression.html" class="quarto-xref"><span>10</span></a>.</p>
<p>Here is a summary of the key variables:</p>
<ul>
<li>
<code>carat</code>: weight of the diamond (ranging from 0.2 to 5.01),</li>
<li>
<code>cut</code>: quality of the cut (Fair, Good, Very Good, Premium, Ideal),</li>
<li>
<code>color</code>: color grade, from D (most colorless) to J (least colorless),</li>
<li>
<code>clarity</code>: clarity grade, from I1 (least clear) to IF (flawless),</li>
<li>
<code>depth</code>: total depth percentage calculated as <code>2 * z / (x + y)</code>,</li>
<li>
<code>table</code>: width of the top facet relative to the widest point,</li>
<li>
<code>x</code>, <code>y</code>, <code>z</code>: physical dimensions in millimeters,</li>
<li>
<code>price</code>: price in US dollars (ranging from $326 to $18,823).</li>
</ul>
<p>Before we can begin cleaning or transforming the data, we need to understand the types of features we are working with. Different types of variables require different preparation strategies. In the next section, we examine how the features in the diamonds dataset are structured and classified.</p>
</section></section><section id="identifying-feature-types" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="identifying-feature-types">
<span class="header-section-number">3.2</span> Identifying Feature Types</h2>
<p>Before detecting outliers or encoding variables, it is crucial to understand what kinds of features we are working with. Whether a variable is numerical or categorical, and what subtype it belongs to, will shape how we clean, transform, and model the data. Feature types influence which visualizations make sense, which preprocessing steps are appropriate, and how machine learning algorithms interpret input values.</p>
<p>Figure <a href="#fig-ch3-feature-type" class="quarto-xref"><span>3.1</span></a> summarizes the main types of features commonly encountered in data science:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-ch3-feature-type" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="H" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ch3-feature-type-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/ch3_feature_type.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:85.0%" data-fig-pos="H">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ch3-feature-type-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Overview of common feature types used in data analysis, including numerical (continuous and discrete) and categorical (ordinal, nominal, and binary) variables.
</figcaption></figure>
</div>
</div>
</div>
<p>Features fall into two broad categories: <em>quantitative (numerical)</em> and <em>categorical (qualitative)</em>, each with important subtypes.</p>
<p><em>Quantitative (Numerical) features</em> represent measurable quantities:</p>
<ul>
<li><p><em>Continuous features</em> can take any value within a range. In the <em>diamonds</em> dataset, variables such as <code>carat</code>, <code>price</code>, <code>x</code>, <code>y</code>, <code>z</code>, and <code>depth</code> are continuous.</p></li>
<li><p><em>Discrete features</em> take on countable values, typically integers. Although not present in this dataset, an example might be the number of prior purchases or visits.</p></li>
</ul>
<p><em>Categorical (Qualitative) features</em> classify observations into groups:</p>
<ul>
<li><p><em>Ordinal features</em> have a meaningful order, though the spacing between levels is not necessarily equal. The <em>diamonds</em> dataset includes ordinal variables like <code>cut</code>, <code>color</code>, and <code>clarity</code>. For example, <code>color</code> ranges from D to J, an alphabetical scale that reflects a progression from most to least colorless.</p></li>
<li><p><em>Nominal features</em> represent categories with no inherent order, such as product types or blood types.</p></li>
<li><p><em>Binary features</em> have exactly two categories, such as “yes”/“no” or “male”/“female”, typically encoded as 0 and 1.</p></li>
</ul>
<p>Although the <em>diamonds</em> dataset does not contain discrete, nominal, or binary features, these are frequently encountered in real-world datasets and require distinct handling strategies.</p>
<p>Understanding feature types helps determine which preprocessing techniques are appropriate. Numerical features often benefit from normalization or standardization, typically using methods such as Min-Max Scaling or Z-score Scaling. Ordinal features are usually encoded with ordinal encoding to preserve their ranking, although one-hot encoding may be used when the rank is not relevant to the analysis. Nominal features, lacking any inherent order, are best handled using one-hot encoding to represent each category as a separate binary feature.</p>
<p>In R, how a variable is stored affects its treatment during analysis. Continuous variables are usually stored as <code>numeric</code>, while discrete ones are often <code>integer</code>. Categorical variables appear as <code>factor</code> objects, which may be either ordered or unordered. You can inspect these using <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> for the full dataset, or use <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> and <code><a href="https://rdrr.io/r/base/typeof.html">typeof()</a></code> to examine specific variables.</p>
<blockquote class="blockquote">
<p><em>Tip:</em> Always check how R interprets your variables. For example, a feature that is conceptually ordinal may be treated as a nominal <code>factor</code> unless explicitly declared as <code>ordered = TRUE</code>.</p>
</blockquote>
<p>Now that we understand the structure of our features, we are ready to begin preparing them, starting with identifying outliers that may distort our analysis.</p>
</section><section id="key-considerations-for-data-preparation" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="key-considerations-for-data-preparation">
<span class="header-section-number">3.3</span> Key Considerations for Data Preparation</h2>
<p>Effective data preparation serves as the bridge between raw input and meaningful statistical analysis. To prepare the <em>diamonds</em> dataset for modeling, we focus on three interrelated priorities: ensuring data quality, engineering relevant features, and transforming variables into suitable formats.</p>
<p>First, data quality is essential. We need to ensure that the dataset is accurate, consistent, and free from major issues. This includes identifying missing values, spotting outliers, and resolving inconsistencies that could introduce bias or reduce model performance.</p>
<p>Second, thoughtful feature engineering can add substantial value. For example, rather than using the <code>x</code>, <code>y</code>, and <code>z</code> dimensions separately, we might create a new variable that captures the <em>volume</em> of each diamond. This derived feature could serve as a more interpretable and effective predictor of price.</p>
<p>Finally, appropriate data transformation ensures that all features are in a format suitable for modeling. Categorical variables like <code>cut</code> or <code>color</code> need to be encoded numerically, using methods that respect their structure and meaning. At the same time, numerical features may require scaling or normalization to ensure they contribute fairly in algorithms that rely on distance or gradient-based optimization.</p>
<p>These three pillars—data quality, feature engineering, and transformation—form the foundation of robust data preparation and help ensure that our modeling efforts are grounded in clean, well-structured, and informative data.</p>
</section><section id="sec-ch3-data-pre-outliers" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="sec-ch3-data-pre-outliers">
<span class="header-section-number">3.4</span> Outliers: What They Are and Why They Matter</h2>
<p>Outliers are observations that stand out from the general pattern of a dataset, extreme values that differ markedly from the rest. They can arise from data entry errors, unusual measurement conditions, or genuinely rare but meaningful events. Regardless of their source, outliers can have an outsized impact on data analysis: they may distort summary statistics, skew visualizations, and mislead machine learning models.</p>
<p>Recognizing and handling outliers appropriately is especially important in real-world applications. In finance, an unusually large transaction could indicate fraud. In healthcare, an extreme lab result might point to a rare diagnosis, or signal a faulty instrument. In manufacturing, sensor readings that deviate from the norm might flag equipment failure or process instability.</p>
<p>However, not all outliers are errors to be discarded. Some reflect valuable exceptions that offer new insights. Removing them indiscriminately risks throwing away useful information; keeping them blindly can undermine model reliability. Sound judgment, grounded in both statistical reasoning and domain knowledge, is essential when deciding how to handle them.</p>
<p>Outlier detection can begin with visual tools such as <em>boxplots</em>, <em>histograms</em>, and <em>scatter plots</em>, which offer intuitive ways to spot anomalies. These methods are especially useful during the exploratory phase of analysis. More formal techniques, such as Z-scores and interquartile range (IQR) thresholds, provide quantitative criteria for identifying unusually high or low values.</p>
<p>In the next section, we apply visual tools to the <em>diamonds</em> dataset to see how outliers manifest in real data and how they might affect our understanding of key variables.</p>
</section><section id="spotting-outliers-with-visual-tools" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="spotting-outliers-with-visual-tools">
<span class="header-section-number">3.5</span> Spotting Outliers with Visual Tools</h2>
<p>Visualization is often the most accessible and informative way to begin detecting outliers. It helps us identify values that stray far from the typical range, whether due to data entry mistakes, rare but valid events, or measurement anomalies. In this section, we apply visual methods to the <code>y</code> variable (diamond width) from the <em>diamonds</em> dataset, a feature known to contain extreme or implausible values that warrant closer inspection.</p>
<section id="boxplots-visualizing-and-flagging-outliers" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="boxplots-visualizing-and-flagging-outliers">Boxplots: Visualizing and Flagging Outliers</h3>
<p>Boxplots provide a compact visual summary of a variable’s distribution. They highlight key statistics, such as the median and interquartile range (IQR), while flagging unusually high or low values as potential outliers. As shown in Figure <a href="#fig-simple-boxplot" class="quarto-xref"><span>3.2</span></a>, the “whiskers” extend to 1.5 times the IQR from the lower and upper quartiles, and data points beyond this range are considered outliers.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-simple-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-pos="H" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-simple-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/ch3_simple_boxplot.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:40.0%" data-fig-pos="H">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-simple-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Boxplots summarize a variable’s distribution and flag extreme values. Outliers are identified as points beyond 1.5 times the interquartile range (IQR) from the quartiles.
</figcaption></figure>
</div>
</div>
</div>
<p>To see this in action, let us apply a boxplot to the <code>y</code> variable (diamond width) in the <em>diamonds</em> dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, fill <span class="op">=</span> <span class="st">"#e5f4fb"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkblue"</span>, fill <span class="op">=</span> <span class="st">"#e5f4fb"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
</div>
<p>The left plot shows the full range of <code>y</code> values, where extreme observations above 15 mm compress the rest of the distribution and obscure the central pattern. The right plot zooms in on a more typical range (0–15 mm), revealing that most diamond widths fall between 2 and 6 mm, with a few clear outliers.</p>
<p>Boxplots like these allow us to quickly identify suspicious values, such as widths near 0 mm or above 15 mm, that are implausible for real diamonds. These anomalies may reflect data entry errors or rare but important cases that deserve closer inspection.</p>
</section><section id="histograms-revealing-outlier-patterns" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="histograms-revealing-outlier-patterns">Histograms: Revealing Outlier Patterns</h3>
<p>Histograms provide a complementary view to boxplots by showing how values are distributed across intervals. They reveal the overall shape of the distribution, highlight skewness, and help detect isolated spikes or rare values that may signal outliers.</p>
<p>The following histogram visualizes the distribution of the <code>y</code> variable (diamond width) using bins of width 0.5:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
<p>In this full-scale view, the concentration of values between 2 and 6 mm is clear, but less frequent values, especially those beyond 15 mm, are hard to see due to scale compression.</p>
<p>To focus on the rare and extreme cases, we zoom in on the lower portion of the frequency axis:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">0.5</span>, color <span class="op">=</span> <span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
<p>This refined view reinforces what we observed in the boxplot, namely, the presence of unusually small or large values in the <code>y</code> variable that fall outside the expected range. These may correspond to data entry errors or genuine anomalies, and they warrant closer inspection. Together with boxplots, histograms are powerful tools for identifying and interpreting potential outliers.</p>
</section><section id="additional-tools-for-visual-outlier-detection" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="additional-tools-for-visual-outlier-detection">Additional Tools for Visual Outlier Detection</h3>
<p>In addition to boxplots and histograms, several other visualization tools can help identify outliers in different contexts:</p>
<ul>
<li><p><em>Violin plots</em> combine the summary statistics of a boxplot with a mirrored density curve, offering insight into both distribution shape and the presence of extreme values.</p></li>
<li><p><em>Density plots</em> provide a smoothed view of the data distribution, making it easier to detect long tails, multiple modes, or subtle irregularities.</p></li>
<li><p><em>Scatter plots</em> are particularly useful for examining relationships between two variables and identifying outliers that deviate from general trends, especially in bivariate or multivariate contexts.</p></li>
</ul>
<p>These tools are valuable in the early stages of analysis, when scanning for irregular patterns or unusual cases. However, as the number of dimensions increases, visual methods alone may no longer suffice. In such cases, formal statistical techniques, covered later in the book, offer more rigorous and scalable solutions for outlier detection.</p>
<p>Now that we have visually identified potential outliers, the next step is to decide how to handle them: whether to remove, transform, or retain these points based on their context and potential impact on analysis and modeling.</p>
</section></section><section id="sec-ch3-handle-outliers" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="sec-ch3-handle-outliers">
<span class="header-section-number">3.6</span> How to Handle Outliers</h2>
<p>Why would a diamond have a width of 0 mm, or a price twenty times higher than its peers? Outliers like these appear in nearly every real-world dataset, and deciding what to do with them is a recurring challenge in data science. When guiding students through messy datasets, I often hear the same question: <em>“Should I remove this outlier?”</em> My advice is to pause and reflect. Not all outliers are errors, and not all errors are obvious.</p>
<p>Once outliers have been identified, either visually or statistically, the next step is to decide how to respond. There is no universal rule. The best course of action depends on whether the outlier reflects a data entry mistake, a rare but valid observation, or a meaningful signal. Context is critical, and decisions should be shaped by the modeling goals and the domain in which the data was collected.</p>
<p>Below are several practical strategies for handling outliers, each with its own trade-offs:</p>
<ul>
<li><p><em>Retain the outlier</em> if it is a valid observation that may contain valuable information. For instance, in fraud detection, statistical outliers often correspond to precisely the cases of interest. In the <em>adult</em> dataset, extreme values for <code>capital.gain</code> may reveal unique high-income individuals. Removing such observations could lead to a loss of predictive power or insight.</p></li>
<li><p><em>Replace the outlier with a missing value</em> when there is strong evidence that it is erroneous. For example, a negative carat weight or a repeated record likely stems from a data entry issue. Replacing such values with <code>NA</code> allows for flexible downstream handling, including imputation strategies introduced in the next section.</p></li>
<li><p><em>Flag and preserve the outlier</em> by creating an indicator variable (e.g., <code>is_outlier</code>) to retain the observation without distorting the analysis. This is especially useful when the outlier might be informative but requires separate treatment.</p></li>
<li><p><em>Apply data transformations</em>, such as logarithmic or square root scaling, to reduce the influence of extreme values while preserving relative patterns.</p></li>
<li><p><em>Apply winsorization</em>, which replaces extreme outlier values with less extreme percentile values (e.g., capping values at the 1st and 99th percentiles). This approach reduces the impact of outliers while retaining all observations, balancing robustness and data retention.</p></li>
<li><p><em>Use robust modeling techniques</em> that are less sensitive to outliers. Decision trees, random forests, and median-based estimators are designed to accommodate variability without being unduly influenced by extreme points.</p></li>
<li><p><em>Remove the outlier</em> only if the value is clearly invalid, cannot be reasonably corrected or imputed, and would otherwise compromise the integrity of the analysis. This should be considered a last resort, not the default action.</p></li>
</ul>
<p>In general, a cautious and informed approach is best. Automatically removing all outliers is tempting, especially for beginners, but it risks discarding rare yet meaningful variation. A thoughtful strategy, grounded in domain knowledge and analytical objectives, ensures that data remains both clean and insightful.</p>
</section><section id="outlier-treatment-in-action" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="outlier-treatment-in-action">
<span class="header-section-number">3.7</span> Outlier Treatment in Action</h2>
<p>Now that we have seen how to spot outliers, how should we handle them in practice? Let us walk through a hands-on example using the <em>diamonds</em> dataset. Take the <code>y</code> variable, which measures diamond width. As we saw earlier, some entries are clearly implausible, values equal to 0 or greater than 30 mm are unlikely for real diamonds and likely stem from data entry errors or measurement glitches.</p>
<p>To fix these values, we turn to the <strong>dplyr</strong> package, part of the <strong>tidyverse</strong>. It offers a powerful yet readable syntax for data manipulation. One of its core functions, <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, allows us to create or modify columns directly within a data frame. If <strong>dplyr</strong> is not yet installed, you can add it with <code>install.packages("dplyr")</code>. Then, load the package and apply the following transformation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>  <span class="co"># Load dplyr package</span></span>
<span></span>
<span><span class="va">diamonds_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">diamonds</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">y</span> <span class="op">&gt;</span> <span class="fl">30</span>, <span class="cn">NA</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This command creates a new dataset, <code>diamonds_2</code>, by replacing suspicious <code>y</code> values with <code>NA</code>. The logic is simple: if <code>y</code> is 0 or greater than 30, it is replaced; otherwise, it is left unchanged. This kind of targeted replacement keeps the rest of the data intact while removing values likely to distort analysis.</p>
<p>To verify the update, summarize the variable:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(diamonds_2<span class="sc">$</span>y)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>      Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max.    NA<span class="st">'s </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">     3.680   4.720   5.710   5.734   6.540  10.540       9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This summary confirms how many values were flagged and how the range has shifted. The extreme outliers no longer dominate the distribution, and we can now proceed with a cleaner variable.</p>
<p><em>Try it yourself:</em> Repeat this process for the <code>x</code> and <code>z</code> variables, which represent length and depth. Do they contain similar implausible values? Replace any unusual values with <code>NA</code>, and use <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to assess the results. Practicing this on multiple variables helps reinforce the principle that outlier treatment is part of an ongoing diagnostic mindset, not just a one-time fix.</p>
<p>In the next section, we will move on to the next step in the data preparation pipeline: how to impute missing values in a statistically informed way.</p>
</section><section id="sec-ch3-missing-values" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="sec-ch3-missing-values">
<span class="header-section-number">3.8</span> Missing Values: What They Are and Why They Matter</h2>
<p>Missing values are not just blank entries—they are clues to a larger story in your dataset. Like a puzzle with missing pieces, incomplete data can hide important patterns, distort results, and mislead your models. Before drawing conclusions or fitting algorithms, it is essential to detect and handle missing data with care.</p>
<p>In R, missing values usually appear as <code>NA</code>, but in real-world datasets, they often hide behind special codes like <code>-1</code>, <code>999</code>, or <code>99.9</code>. These placeholder values are easy to miss, and if ignored, can quietly undermine your analysis. For instance, in the <em>cereal</em> dataset from the <strong>liver</strong> package (explored in Section <a href="13-Clustering.html#sec-ch13-case-study" class="quarto-xref"><span>13.4</span></a>), the <code>calories</code> variable uses <code>-1</code> to indicate missing data. Similarly, in the <em>bank</em> marketing dataset (Section <a href="12-Neural-networks.html#sec-ch12-case-study" class="quarto-xref"><span>12.6</span></a>), the <code>pday</code> variable uses <code>-1</code> to signal that a client was not contacted. Recognizing and recoding these special cases is a crucial first step.</p>
<p>As highlighted in the story of Abraham Wald (Section <a href="2-Intro-data-science.html#sec-ch2-Problem-Understanding" class="quarto-xref"><span>2.4</span></a>), missing data is not always random. Wald’s insight came from what he <em>could not</em> see, damage on planes that never returned. In data science, the absence of information can be just as telling as its presence. Overlooking this subtlety can lead to flawed assumptions and inaccurate models.</p>
<p>Students often ask, “How should we deal with missing values?” My advice is to avoid deleting data unless there is no alternative. While dropping incomplete rows is fast, it is rarely the best choice. In fact, if just 5% of values are missing across 30 variables, removing all rows with missing entries could eliminate up to 80% of your dataset. That is a steep price to pay. A more thoughtful approach, such as imputing missing values, preserves valuable information while supporting the goals of your analysis.</p>
<p>Broadly, there are two strategies for handling missing data:</p>
<ul>
<li><p><em>Imputation</em> involves estimating missing values using observed data. This method retains all records and helps maintain analytical completeness.</p></li>
<li><p><em>Removal</em> excludes rows or columns with missing entries. While sometimes necessary, this approach can significantly shrink your dataset and introduce bias, especially if the missingness is not random.</p></li>
</ul>
<p>In the following sections, we will explore how to identify missing values, understand their impact, and apply appropriate imputation techniques to create a more complete and trustworthy dataset.</p>
</section><section id="imputation-techniques" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="imputation-techniques">
<span class="header-section-number">3.9</span> Imputation Techniques</h2>
<p>Once missing values have been identified, the next step is to choose an appropriate strategy for estimating them. The best method depends on the structure of the data, the analysis objectives, and how much complexity is acceptable. Below are several commonly used approaches:</p>
<ul>
<li><p><em>Mean, median, or mode imputation</em> replaces missing entries with the average (for numerical variables), median (for skewed distributions), or the most frequent category (for categorical variables). These simple methods are best suited for low levels of missingness and relatively uniform data.</p></li>
<li><p><em>Random sampling</em> fills in missing values by drawing randomly from the observed values of the same variable. This technique preserves the variable’s distribution better than mean imputation but introduces randomness into the analysis.</p></li>
<li><p><em>Predictive imputation</em> uses other variables in the dataset to estimate missing values through models such as linear regression, decision trees, or <em>k</em>-nearest neighbors. This approach is more accurate when strong relationships exist between variables.</p></li>
<li><p><em>Multiple imputation</em> generates several completed datasets by repeating the imputation process multiple times and then combines results across them. This method accounts for uncertainty in the missing values and is especially useful for inference or reporting confidence intervals.</p></li>
</ul>
<p>Selecting the right imputation method involves balancing simplicity and precision. For numerical variables with few missing entries, mean or median imputation often suffices. For categorical variables, mode imputation provides a straightforward alternative. In cases with substantial missingness or complex dependencies, predictive methods, such as regression or <em>k</em>-nearest neighbors, offer more reliable results. If a variable is missing too frequently, it may be better to exclude it or reconsider its role in the analysis.</p>
<p>In the coming example, we demonstrate the random sampling approach for its simplicity and illustrative value. However, in real-world applications, more advanced techniques are often preferred. Later in this chapter and in Chapter <a href="13-Clustering.html" class="quarto-xref"><span>13</span></a> (Section <a href="13-Clustering.html#sec-ch13-case-study" class="quarto-xref"><span>13.4</span></a>), we revisit this topic using Random Forest algorithm for imputation. This transition from basic to sophisticated methods reflects the increasing demands of applied data science.</p>
<section id="example-random-sampling-imputation-in-r" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="example-random-sampling-imputation-in-r">Example: Random Sampling Imputation in R</h3>
<p>Let us now put imputation into practice using the <code>y</code> variable (diamond width) in the <em>diamonds</em> dataset. Earlier, we flagged implausible values, such as 0 or values above 30 mm, as missing (<code>NA</code>). Our goal here is to replace those missing values using <em>random sampling</em>, a simple technique that draws replacements from the observed, non-missing values of the same variable.</p>
<p>We use the <code><a href="https://rdrr.io/pkg/Hmisc/man/impute.html">impute()</a></code> function from the <strong>Hmisc</strong> package, which supports several basic imputation strategies. If the package is not installed on your system, you can add it using <code>install.packages("Hmisc")</code>. Then, load the package and apply the imputation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/">Hmisc</a></span><span class="op">)</span>  <span class="co"># Load Hmisc package</span></span>
<span></span>
<span><span class="va">diamonds_2</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/impute.html">impute</a></span><span class="op">(</span><span class="va">diamonds_2</span><span class="op">$</span><span class="va">y</span>, <span class="st">"random"</span><span class="op">)</span>  <span class="co"># Randomly fill in missing values in y</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This command replaces each <code>NA</code> in the <code>y</code> column with a randomly selected value from the observed values, preserving the variable’s distribution. Because this technique introduces no systematic bias, it works well in exploratory settings where preserving the shape of the data is more important than prediction accuracy.</p>
<p>To assess the effect of imputation visually, the scatter plots below show the relationship between diamond width (<code>y</code>) and price before and after imputation:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Before imputation (with NAs)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Original Distribution (with Outliers)"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># After random sampling imputation</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds_2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"After Random Sampling Imputation"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
</div>
<p>These plots illustrate that after removing implausible values and imputing missing entries, the data retains its overall structure while discarding extremes that could distort model training. Since price is our eventual target variable (see Chapter <a href="10-Regression.html" class="quarto-xref"><span>10</span></a>), this visualization also helps assess whether the cleaned <code>y</code> values still support meaningful patterns.</p>
<p><em>Try it yourself:</em> Apply the same technique to the <code>x</code> and <code>z</code> variables, which represent diamond length and depth. First identify implausible values, recode them as <code>NA</code>, and then impute them using random sampling. Reflect on how these changes affect the variables’ relationships with price.</p>
</section><section id="alternative-approaches" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="alternative-approaches">Alternative Approaches</h3>
<p>The <code><a href="https://rdrr.io/pkg/Hmisc/man/impute.html">impute()</a></code> function also supports statistical imputation methods such as mean, median, and mode. By default, it performs <em>median imputation</em>. For more advanced tasks, <code><a href="https://rdrr.io/pkg/Hmisc/man/aregImpute.html">aregImpute()</a></code> (also from <strong>Hmisc</strong>) enables predictive imputation using techniques like additive regression and bootstrapping.</p>
<p>While removing missing records via <code><a href="https://rdrr.io/r/stats/na.fail.html">na.omit()</a></code> is a simple option, it is usually discouraged unless the missingness is widespread or systematically biased. Properly addressing missing data helps maintain data integrity and prepares the dataset for subsequent steps, such as encoding categorical variables and aggregating country-level categories.</p>
<p>In later sections, including the case study in Chapter <a href="13-Clustering.html#sec-ch13-case-study" class="quarto-xref"><span>13.4</span></a>, we will revisit this topic using more advanced methods such as <em>k</em>-nearest neighbors imputation, which estimates missing values based on the similarity across multiple variables.</p>
<p>Now that missing values have been identified and imputed, the dataset is more complete and ready for further preparation. The next key step is feature scaling, which ensures that numerical variables are on comparable scales.</p>
</section></section><section id="sec-ch3-feature-scaling" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="sec-ch3-feature-scaling">
<span class="header-section-number">3.10</span> Feature Scaling</h2>
<p>What happens when one variable, such as price in dollars, spans tens of thousands, while another, like carat weight, ranges only from 0 to 5? Without scaling, machine learning models that rely on distances or gradients may give disproportionate weight to features with larger numerical ranges, regardless of their actual importance.</p>
<p><em>Feature scaling</em> addresses this imbalance by adjusting the range or distribution of numerical features to make them comparable. It is particularly important for algorithms such as <em>k</em>-nearest neighbors (Chapter <a href="7-Classification-kNN.html" class="quarto-xref"><span>7</span></a>), support vector machines, and neural networks. Scaling can also improve optimization stability in models like logistic regression and enhance the interpretability of coefficients.</p>
<p>In the <em>diamonds</em> dataset, for example, <code>carat</code> ranges from 0.2 to 5, while <code>price</code> spans from 326 to 18823. Without scaling, features like <code>price</code> may dominate the learning process, not because they are more predictive, but simply because of their magnitude.</p>
<p>This section introduces two widely used scaling techniques:</p>
<ul>
<li><p><em>Min-Max Scaling</em> rescales values to a fixed range, typically <span class="math inline">\([0, 1]\)</span>.</p></li>
<li><p><em>Z-score Scaling</em> centers values at zero with a standard deviation of one.</p></li>
</ul>
<p>Choosing between these methods depends on the model and the structure of the data. Min-Max Scaling is preferred when a fixed input range is required (as in neural networks), whereas Z-score Scaling is better suited for algorithms that assume standardized input distributions or rely on variance-sensitive optimization.</p>
<p>Note that scaling is not always necessary. Tree-based models, such as decision trees and random forests, are scale-invariant and do not require rescaled inputs. But for many other algorithms, scaling improves model performance, convergence speed, and fairness across features.</p>
<p>One caution: scaling can obscure real-world units or exaggerate the effect of outliers, especially when using Min-Max Scaling. As always, the choice of technique should reflect your modeling objectives and the nature of your dataset. In the following sections, we demonstrate how to apply each technique using the <em>diamonds</em> dataset.</p>
</section><section id="min-max-scaling" class="level2" data-number="3.11"><h2 data-number="3.11" class="anchored" data-anchor-id="min-max-scaling">
<span class="header-section-number">3.11</span> Min-Max Scaling</h2>
<p>When one feature ranges from 0 to 1 and another spans thousands, models that rely on distances, like <em>k</em>-nearest neighbors, may be skewed toward features with larger scales. <em>Min-Max Scaling</em> addresses this by rescaling each feature to a common range, typically <span class="math inline">\([0, 1]\)</span>, so that no single variable dominates due to its units.</p>
<p>The transformation is defined by the formula:</p>
<p><span class="math display">\[
x_{\text{scaled}} = \frac{x - x_{\text{min}}}{x_{\text{max}} - x_{\text{min}}},
\]</span></p>
<p>where <span class="math inline">\(x\)</span> is the original value, and <span class="math inline">\(x_{\text{min}}\)</span> and <span class="math inline">\(x_{\text{max}}\)</span> are the minimum and maximum values of the feature. This method ensures that the minimum value becomes 0 and the maximum becomes 1.</p>
<p>Min-Max Scaling is especially useful for algorithms that use distance or gradient information, including neural networks and support vector machines. However, this technique is sensitive to outliers: extreme values can stretch the scale, compressing most of the data into a narrow band and reducing resolution for typical values.</p>
<div id="ex-min-max" class="example">
<p>To see Min-Max Scaling in action, we apply it to the <code>carat</code> variable in the <em>diamonds</em> dataset. This variable ranges from approximately 0.2 to 5. We use the <code><a href="https://rdrr.io/pkg/liver/man/minmax.html">minmax()</a></code> function from the <strong>liver</strong> package to rescale the values to the <span class="math inline">\([0, 1]\)</span> interval:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histogram of `carat` (original scale)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Carat"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">minmax</span><span class="op">(</span><span class="va">carat</span><span class="op">)</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histogram of `carat` (Min-Max scaled)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Carat (scaled)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
</div>
<p>The left panel shows the raw distribution of carat values, while the right panel displays the scaled version. After transformation, all values fall within the <span class="math inline">\([0, 1]\)</span> range, making this feature numerically comparable to others. This is particularly important when modeling techniques depend on distance or gradient magnitude.</p>
</div>
</section><section id="z-score-scaling" class="level2" data-number="3.12"><h2 data-number="3.12" class="anchored" data-anchor-id="z-score-scaling">
<span class="header-section-number">3.12</span> Z-score Scaling</h2>
<p>While Min-Max Scaling compresses values into a fixed range, <em>Z-score Scaling</em>, also known as standardization, centers each numerical feature around zero and scales it to have unit variance. This technique is especially useful for algorithms that assume normally distributed input or rely on gradient-based optimization, such as linear regression, logistic regression, and support vector machines.</p>
<p>The formula for Z-score Scaling is:</p>
<p><span class="math display">\[
x_{\text{scaled}} = \frac{x - \text{mean}(x)}{\text{sd}(x)},
\]</span></p>
<p>where <span class="math inline">\(x\)</span> is the original feature value, <span class="math inline">\(\text{mean}(x)\)</span> is the mean of the feature, and <span class="math inline">\(\text{sd}(x)\)</span> is its standard deviation. The result, <span class="math inline">\(x_{\text{scaled}}\)</span>, tells us how many standard deviations the value is from the mean.</p>
<p>Z-score Scaling helps place features with different units or magnitudes on a common footing. However, it is still sensitive to outliers, since both the mean and standard deviation can be influenced by extreme values.</p>
<div id="ex-zscore" class="example">
<p>To illustrate, let us apply Z-score Scaling to the <code>carat</code> variable in the <em>diamonds</em> dataset. The mean and standard deviation of <code>carat</code> are approximately 0.8 and 0.47, respectively. We use the <code><a href="https://rdrr.io/pkg/liver/man/zscore.html">zscore()</a></code> function from the <strong>liver</strong> package:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histogram of `carat` (original scale)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Carat"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diamonds</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">zscore</span><span class="op">(</span><span class="va">carat</span><span class="op">)</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                 color <span class="op">=</span> <span class="st">'blue'</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histogram of `carat` (Z-score scaled)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Carat (scaled)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
</div>
<p>The left panel shows the original distribution of <code>carat</code> values. The right panel displays the Z-score scaled version, where the values are centered around 0 and spread in units of standard deviation. While the location and scale are adjusted, the shape of the distribution, including any skewness, remains unchanged.</p>
</div>
<p>Note that Z-score Scaling does not make a variable normally distributed. It standardizes the location and spread but preserves the shape. If the original variable is skewed, it will remain skewed after transformation.</p>
<p>With numerical features now on a comparable scale, the next step is to turn our attention to <em>categorical variables</em>. Unlike numerical features, these cannot be used directly in most models—they must be encoded numerically. In the next section, we explore encoding strategies for different types of categorical data, including ordinal and nominal variables.</p>
</section><section id="sec-ch3-encoding" class="level2" data-number="3.13"><h2 data-number="3.13" class="anchored" data-anchor-id="sec-ch3-encoding">
<span class="header-section-number">3.13</span> Encoding Categorical Features for Modeling</h2>
<p>Categorical features often need to be transformed into numeric format before they can be used in machine learning models. Algorithms such as <em>k</em>-Nearest Neighbors and neural networks require numerical inputs, and failure to encode categorical data properly can lead to misleading results or even errors during model training.</p>
<p>Encoding categorical variables is a critical step in data preparation. It allows us to incorporate qualitative information, such as quality ratings, group memberships, or types, into models that operate on numerical representations. In this section, we explore several encoding techniques and illustrate their use with examples from the <em>diamonds</em> dataset, which includes the categorical variables <code>cut</code>, <code>color</code>, and <code>clarity</code>.</p>
<p>The appropriate encoding strategy depends on the nature of the categorical variable. For ordinal variables, those with an inherent ranking, ordinal encoding preserves the order of categories using numerical values. For example, the <code>cut</code> variable in the <em>diamonds</em> dataset ranges from “Fair” to “Ideal” and benefits from ordinal encoding.</p>
<p>In contrast, nominal variables, categories without intrinsic order, are better served by one-hot encoding. This approach creates binary indicators for each category and is particularly effective for features such as marital status in the <em>bank</em> dataset introduced in Chapter <a href="12-Neural-networks.html#sec-ch12-case-study" class="quarto-xref"><span>12.6</span></a>.</p>
<p>In the sections that follow, we demonstrate these encoding techniques in practice, starting with ordinal encoding and one-hot, using the <em>diamonds</em> and <em>bank</em> datasets as guiding examples.</p>
</section><section id="sec-ch3-ordinal-encoding" class="level2" data-number="3.14"><h2 data-number="3.14" class="anchored" data-anchor-id="sec-ch3-ordinal-encoding">
<span class="header-section-number">3.14</span> Ordinal Encoding</h2>
<p>When a categorical variable has a meaningful ranking, <em>ordinal encoding</em> provides a simple and effective transformation. Instead of treating each category as unrelated, we assign numerical values that reflect the natural order, allowing models to capture rank-based patterns.</p>
<p>Take the <code>cut</code> variable in the <em>diamonds</em> dataset, which reflects increasing quality:</p>
<ul>
<li>“Fair” <span class="math inline">\(\mapsto\)</span> 1;</li>
<li>“Good” <span class="math inline">\(\mapsto\)</span> 2;</li>
<li>“Very Good” <span class="math inline">\(\mapsto\)</span> 3;</li>
<li>“Premium” <span class="math inline">\(\mapsto\)</span> 4;</li>
<li>“Ideal” <span class="math inline">\(\mapsto\)</span> 5.</li>
</ul>
<p>This numeric representation preserves the ordinal structure and can enhance the performance of models that recognize order, such as linear regression or decision trees.</p>
<p>However, ordinal encoding should only be used when the order of categories is <em>truly meaningful</em>. Applying this method to <em>nominal</em> variables, like “red”, “green”, and “blue”, can be misleading. Encoding those as 1, 2, and 3 suggests a false hierarchy and may bias the model.</p>
<p>Always match the encoding method to the nature of the variable. For unordered categories, consider one-hot or frequency encoding instead. In the next section, we explore one-hot encoding, which treats each category as distinct, ideal for variables without any natural ordering.</p>
</section><section id="sec-ch3-one-hot-encoding" class="level2" data-number="3.15"><h2 data-number="3.15" class="anchored" data-anchor-id="sec-ch3-one-hot-encoding">
<span class="header-section-number">3.15</span> One-Hot Encoding</h2>
<p>How can we represent unordered categories, like marital status or race, so that machine learning algorithms can work with them? <em>One-hot encoding</em> is a widely used solution. It transforms each unique category into a separate binary column, allowing algorithms to process categorical data without introducing artificial order.</p>
<p>This method is especially useful for <em>nominal variables</em>, categorical features with no inherent ranking. For example, a variable like <code>marital.status</code> in the <em>adult</em> dataset includes categories such as <code>Divorced</code>, <code>Married</code>, and <code>Never-married</code>. One-hot encoding creates binary variables like:</p>
<ul>
<li>
<code>marital.status_Divorced</code>;</li>
<li>
<code>marital.status_Married</code>;</li>
<li>
<code>marital.status_Never-married</code>;</li>
<li>
<code>marital.status_Separated</code>.</li>
</ul>
<p>Each column indicates the presence (1) or absence (0) of a specific category. If there are <span class="math inline">\(k\)</span> levels, only <span class="math inline">\(k - 1\)</span> binary columns are needed to avoid multicollinearity—the omitted category is implicitly captured when all others are zero.</p>
<p>Let us take a quick look at the <code>marital.status</code> variable in the <em>adult</em> dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(adult)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(adult<span class="sc">$</span>marital.status)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        Divorced       Married Never<span class="sc">-</span>married     Separated       Widowed </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="dv">6613</span>         <span class="dv">22847</span>         <span class="dv">16096</span>          <span class="dv">1526</span>          <span class="dv">1516</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output shows the distribution of values across the five categories. We will use one-hot encoding to transform these into model-ready binary features. This approach ensures that all categories are represented without assuming any order or relationship among them.</p>
<p>Note that one-hot encoding is essential for models that rely on distance metrics (e.g., k-nearest neighbors, neural networks) or linear models where numeric input is required.</p>
<section id="one-hot-encoding-in-r" class="level3" data-number="3.15.1"><h3 data-number="3.15.1" class="anchored" data-anchor-id="one-hot-encoding-in-r">
<span class="header-section-number">3.15.1</span> One-Hot Encoding in R</h3>
<p>To apply one-hot encoding in practice, we use the <code><a href="https://rdrr.io/pkg/liver/man/one.hot.html">one.hot()</a></code> function from the <strong>liver</strong> package. This function automatically detects categorical variables and generates a new column for each unique level, converting them into binary indicators.</p>
<p>Let us apply it to the <code>marital.status</code> variable in the <em>adult</em> dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode the 'marital.status' variable</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>adult_encoded <span class="ot">&lt;-</span> <span class="fu">one.hot</span>(adult, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"marital.status"</span>), <span class="at">dropCols =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine the structure of the resulting dataset</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(adult_encoded)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">'data.frame'</span><span class="sc">:</span>    <span class="dv">48598</span> obs. of  <span class="dv">20</span> variables<span class="sc">:</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span> age                         <span class="sc">:</span> int  <span class="dv">25</span> <span class="dv">38</span> <span class="dv">28</span> <span class="dv">44</span> <span class="dv">18</span> <span class="dv">34</span> <span class="dv">29</span> <span class="dv">63</span> <span class="dv">24</span> <span class="dv">55</span> ...</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> workclass                   <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">6</span> levels <span class="st">"?"</span>,<span class="st">"Gov"</span>,<span class="st">"Never-worked"</span>,..<span class="sc">:</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">4</span> ...</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> demogweight                 <span class="sc">:</span> int  <span class="dv">226802</span> <span class="dv">89814</span> <span class="dv">336951</span> <span class="dv">160323</span> <span class="dv">103497</span> <span class="dv">198693</span> <span class="dv">227026</span> <span class="dv">104626</span> <span class="dv">369667</span> <span class="dv">104996</span> ...</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> education                   <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">16</span> levels <span class="st">"10th"</span>,<span class="st">"11th"</span>,..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">12</span> <span class="dv">8</span> <span class="dv">16</span> <span class="dv">16</span> <span class="dv">1</span> <span class="dv">12</span> <span class="dv">15</span> <span class="dv">16</span> <span class="dv">6</span> ...</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> education.num               <span class="sc">:</span> int  <span class="dv">7</span> <span class="dv">9</span> <span class="dv">12</span> <span class="dv">10</span> <span class="dv">10</span> <span class="dv">6</span> <span class="dv">9</span> <span class="dv">15</span> <span class="dv">10</span> <span class="dv">4</span> ...</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status              <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">"Divorced"</span>,<span class="st">"Married"</span>,..<span class="sc">:</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">2</span> ...</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status_Divorced     <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status_Married      <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span> ...</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status_Never<span class="sc">-</span>married<span class="sc">:</span> int  <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> ...</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status_Separated    <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status_Widowed      <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> occupation                  <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">15</span> levels <span class="st">"?"</span>,<span class="st">"Adm-clerical"</span>,..<span class="sc">:</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">12</span> <span class="dv">8</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">1</span> <span class="dv">11</span> <span class="dv">9</span> <span class="dv">4</span> ...</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> relationship                <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">6</span> levels <span class="st">"Husband"</span>,<span class="st">"Not-in-family"</span>,..<span class="sc">:</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">1</span> ...</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> race                        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">"Amer-Indian-Eskimo"</span>,..<span class="sc">:</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">5</span> ...</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> gender                      <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">"Female"</span>,<span class="st">"Male"</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> ...</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> capital.gain                <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">7688</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">3103</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> capital.loss                <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> hours.per.week              <span class="sc">:</span> int  <span class="dv">40</span> <span class="dv">50</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">30</span> <span class="dv">30</span> <span class="dv">40</span> <span class="dv">32</span> <span class="dv">40</span> <span class="dv">10</span> ...</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> native.country              <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">42</span> levels <span class="st">"?"</span>,<span class="st">"Cambodia"</span>,..<span class="sc">:</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> ...</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> income                      <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">"&lt;=50K"</span>,<span class="st">"&gt;50K"</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>cols</code> argument specifies which variable(s) to encode. Setting <code>dropCols = FALSE</code> keeps the original variable alongside the new binary columns; use <code>TRUE</code> if you prefer to remove it after encoding.</p>
<p>This transformation adds new columns such as <code>marital.status_Divorced</code>, <code>marital.status_Married</code>, and so on, each indicating whether a given observation belongs to that category.</p>
<blockquote class="blockquote">
<p><em>Try it yourself:</em> What happens if you encode multiple variables at once? Try applying <code><a href="https://rdrr.io/pkg/liver/man/one.hot.html">one.hot()</a></code> to both <code>marital.status</code> and <code>race</code> and inspect the output.</p>
</blockquote>
<p>While one-hot encoding is simple and effective, it can quickly increase the number of features, especially when applied to high-cardinality variables (e.g., zip codes or product names). Before encoding, consider whether the added dimensionality is manageable for your model and whether all categories are meaningful for the analysis.</p>
</section></section><section id="sec-ch3-data-pre-adult" class="level2" data-number="3.16"><h2 data-number="3.16" class="anchored" data-anchor-id="sec-ch3-data-pre-adult">
<span class="header-section-number">3.16</span> Case Study: Preparing Data to Predict High Earners</h2>
<p>How can we predict whether a person earns more than $50,000 per year based on their background? This question arises in many domains, from economic research to policy evaluation and algorithmic hiring tools. In this case study, we use the <em>adult</em> dataset, originally compiled from the <a href="https://www.census.gov">US Census Bureau</a>, to explore how structured demographic data can inform such predictions.</p>
<p>The <em>adult</em> dataset includes information on age, education, marital status, occupation, and income, and is available via the <strong>liver</strong> package. For documentation, see <a href="https://www.rdocumentation.org/packages/liver/versions/1.3/topics/adult">this link</a>.</p>
<p>Our objective is to predict whether an individual earns more than $50,000 annually. In Chapter <a href="11-Tree-based-models.html" class="quarto-xref"><span>11</span></a>, we will return to this dataset to build predictive models using decision trees and random forests (see Section <a href="11-Tree-based-models.html#sec-ch11-case-study" class="quarto-xref"><span>11.5</span></a>). Here, our focus is on preparing the data for modeling: identifying and addressing missing values, encoding categorical variables, detecting outliers, and scaling numerical features.</p>
<section id="overview-of-the-dataset" class="level3" data-number="3.16.1"><h3 data-number="3.16.1" class="anchored" data-anchor-id="overview-of-the-dataset">
<span class="header-section-number">3.16.1</span> Overview of the Dataset</h3>
<p>The <em>adult</em> dataset is a classic benchmark in machine learning, widely used for exploring income prediction based on demographic features. It reflects many of the data preparation challenges that analysts encounter in real-world applications.</p>
<p>To begin, let us load the <em>adult</em> dataset from the <strong>liver</strong> package. If you do not have the package installed, use the following command: <code>install.packages("liver")</code>. Then load the package and dataset:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://book-data-science-r.netlify.app/">liver</a></span><span class="op">)</span>  <span class="co"># Load the liver package</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">adult</span><span class="op">)</span>     <span class="co"># Load the adult dataset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To explore the dataset structure and data types, use the <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(adult)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">'data.frame'</span><span class="sc">:</span>    <span class="dv">48598</span> obs. of  <span class="dv">15</span> variables<span class="sc">:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="er">$</span> age           <span class="sc">:</span> int  <span class="dv">25</span> <span class="dv">38</span> <span class="dv">28</span> <span class="dv">44</span> <span class="dv">18</span> <span class="dv">34</span> <span class="dv">29</span> <span class="dv">63</span> <span class="dv">24</span> <span class="dv">55</span> ...</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> workclass     <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">6</span> levels <span class="st">"?"</span>,<span class="st">"Gov"</span>,<span class="st">"Never-worked"</span>,..<span class="sc">:</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">4</span> ...</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> demogweight   <span class="sc">:</span> int  <span class="dv">226802</span> <span class="dv">89814</span> <span class="dv">336951</span> <span class="dv">160323</span> <span class="dv">103497</span> <span class="dv">198693</span> <span class="dv">227026</span> <span class="dv">104626</span> <span class="dv">369667</span> <span class="dv">104996</span> ...</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> education     <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">16</span> levels <span class="st">"10th"</span>,<span class="st">"11th"</span>,..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">12</span> <span class="dv">8</span> <span class="dv">16</span> <span class="dv">16</span> <span class="dv">1</span> <span class="dv">12</span> <span class="dv">15</span> <span class="dv">16</span> <span class="dv">6</span> ...</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> education.num <span class="sc">:</span> int  <span class="dv">7</span> <span class="dv">9</span> <span class="dv">12</span> <span class="dv">10</span> <span class="dv">10</span> <span class="dv">6</span> <span class="dv">9</span> <span class="dv">15</span> <span class="dv">10</span> <span class="dv">4</span> ...</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> marital.status<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">"Divorced"</span>,<span class="st">"Married"</span>,..<span class="sc">:</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">2</span> ...</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> occupation    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">15</span> levels <span class="st">"?"</span>,<span class="st">"Adm-clerical"</span>,..<span class="sc">:</span> <span class="dv">8</span> <span class="dv">6</span> <span class="dv">12</span> <span class="dv">8</span> <span class="dv">1</span> <span class="dv">9</span> <span class="dv">1</span> <span class="dv">11</span> <span class="dv">9</span> <span class="dv">4</span> ...</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> relationship  <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">6</span> levels <span class="st">"Husband"</span>,<span class="st">"Not-in-family"</span>,..<span class="sc">:</span> <span class="dv">4</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">2</span> <span class="dv">5</span> <span class="dv">1</span> <span class="dv">5</span> <span class="dv">1</span> ...</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> race          <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">5</span> levels <span class="st">"Amer-Indian-Eskimo"</span>,..<span class="sc">:</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">3</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">5</span> ...</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> gender        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">"Female"</span>,<span class="st">"Male"</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> ...</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> capital.gain  <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">7688</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">3103</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> capital.loss  <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> hours.per.week<span class="sc">:</span> int  <span class="dv">40</span> <span class="dv">50</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">30</span> <span class="dv">30</span> <span class="dv">40</span> <span class="dv">32</span> <span class="dv">40</span> <span class="dv">10</span> ...</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> native.country<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">42</span> levels <span class="st">"?"</span>,<span class="st">"Cambodia"</span>,..<span class="sc">:</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> <span class="dv">40</span> ...</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="sc">$</span> income        <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">"&lt;=50K"</span>,<span class="st">"&gt;50K"</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The dataset contains 48598 observations and 15 variables. Most are predictors, while the target variable, <code>income</code>, indicates whether an individual earns more than $50,000 per year (<code>&gt;50K</code>) or not (<code>&lt;=50K</code>). The features include a mix of numerical and categorical variables, reflecting a range of demographic and economic attributes.</p>
<p>Below is a summary of the main variables:</p>
<ul>
<li>
<code>age</code>: Age in years (numerical);</li>
<li>
<code>workclass</code>: Employment type (categorical; 6 levels);</li>
<li>
<code>demogweight</code>: Census weighting factor (numerical);</li>
<li>
<code>education</code>: Highest educational attainment (categorical; 16 levels);</li>
<li>
<code>education.num</code>: Years of education (numerical);</li>
<li>
<code>marital.status</code>: Marital status (categorical; 5 levels);</li>
<li>
<code>occupation</code>: Job type (categorical; 15 levels);</li>
<li>
<code>relationship</code>: Household role (categorical; 6 levels);</li>
<li>
<code>race</code>: Racial background (categorical; 5 levels);</li>
<li>
<code>gender</code>: Gender identity (categorical; 2 levels);</li>
<li>
<code>capital.gain</code>: Annual capital gains (numerical);</li>
<li>
<code>capital.loss</code>: Annual capital losses (numerical);</li>
<li>
<code>hours.per.week</code>: Weekly working hours (numerical);</li>
<li>
<code>native.country</code>: Country of origin (categorical; 42 levels);</li>
<li>
<code>income</code>: Income bracket (<code>&lt;=50K</code> or <code>&gt;50K</code>).</li>
</ul>
<p>The dataset includes both numeric and categorical features, which we group as follows:</p>
<ul>
<li><p>Numerical variables: <code>age</code>, <code>demogweight</code>, <code>education.num</code>, <code>capital.gain</code>, <code>capital.loss</code>, <code>hours.per.week</code>.</p></li>
<li><p>Binary variables: <code>gender</code>, <code>income</code>.</p></li>
<li><p>Ordinal variable: <code>education</code> (ordered from “Preschool” to “Doctorate”).</p></li>
<li><p>Nominal variables: <code>workclass</code>, <code>marital.status</code>, <code>occupation</code>, <code>relationship</code>, <code>race</code>, <code>native.country</code>.</p></li>
</ul>
<p>To better understand the dataset, use <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to inspect distributions, detect possible anomalies, and identify missing values:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(adult)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>         age              workclass      demogweight             education     education.num         marital.status </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    Min.   <span class="sc">:</span><span class="fl">17.0</span>   ?           <span class="sc">:</span> <span class="dv">2794</span>   Min.   <span class="sc">:</span>  <span class="dv">12285</span>   HS<span class="sc">-</span>grad     <span class="sc">:</span><span class="dv">15750</span>   Min.   <span class="sc">:</span> <span class="fl">1.00</span>   Divorced     <span class="sc">:</span> <span class="dv">6613</span>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>st Qu.<span class="sc">:</span><span class="fl">28.0</span>   Gov         <span class="sc">:</span> <span class="dv">6536</span>   <span class="dv">1</span>st Qu.<span class="sc">:</span> <span class="dv">117550</span>   Some<span class="sc">-</span>college<span class="sc">:</span><span class="dv">10860</span>   <span class="dv">1</span>st Qu.<span class="sc">:</span> <span class="fl">9.00</span>   Married      <span class="sc">:</span><span class="dv">22847</span>  </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    Median <span class="sc">:</span><span class="fl">37.0</span>   Never<span class="sc">-</span>worked<span class="sc">:</span>   <span class="dv">10</span>   Median <span class="sc">:</span> <span class="dv">178215</span>   Bachelors   <span class="sc">:</span> <span class="dv">7962</span>   Median <span class="sc">:</span><span class="fl">10.00</span>   Never<span class="sc">-</span>married<span class="sc">:</span><span class="dv">16096</span>  </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    Mean   <span class="sc">:</span><span class="fl">38.6</span>   Private     <span class="sc">:</span><span class="dv">33780</span>   Mean   <span class="sc">:</span> <span class="dv">189685</span>   Masters     <span class="sc">:</span> <span class="dv">2627</span>   Mean   <span class="sc">:</span><span class="fl">10.06</span>   Separated    <span class="sc">:</span> <span class="dv">1526</span>  </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>rd Qu.<span class="sc">:</span><span class="fl">48.0</span>   Self<span class="sc">-</span>emp    <span class="sc">:</span> <span class="dv">5457</span>   <span class="dv">3</span>rd Qu.<span class="sc">:</span> <span class="dv">237713</span>   Assoc<span class="sc">-</span>voc   <span class="sc">:</span> <span class="dv">2058</span>   <span class="dv">3</span>rd Qu.<span class="sc">:</span><span class="fl">12.00</span>   Widowed      <span class="sc">:</span> <span class="dv">1516</span>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    Max.   <span class="sc">:</span><span class="fl">90.0</span>   Without<span class="sc">-</span>pay <span class="sc">:</span>   <span class="dv">21</span>   Max.   <span class="sc">:</span><span class="dv">1490400</span>   <span class="dv">11</span>th        <span class="sc">:</span> <span class="dv">1812</span>   Max.   <span class="sc">:</span><span class="fl">16.00</span>                        </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                                                          (Other)     <span class="sc">:</span> <span class="dv">7529</span>                                        </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>              occupation            relationship                   race          gender       capital.gain    </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    Craft<span class="sc">-</span>repair   <span class="sc">:</span> <span class="dv">6096</span>   Husband       <span class="sc">:</span><span class="dv">19537</span>   Amer<span class="sc">-</span>Indian<span class="sc">-</span>Eskimo<span class="sc">:</span>  <span class="dv">470</span>   Female<span class="sc">:</span><span class="dv">16156</span>   Min.   <span class="sc">:</span>    <span class="fl">0.0</span>  </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    Prof<span class="sc">-</span>specialty <span class="sc">:</span> <span class="dv">6071</span>   Not<span class="sc">-</span><span class="cf">in</span><span class="sc">-</span>family <span class="sc">:</span><span class="dv">12546</span>   Asian<span class="sc">-</span>Pac<span class="sc">-</span>Islander<span class="sc">:</span> <span class="dv">1504</span>   Male  <span class="sc">:</span><span class="dv">32442</span>   <span class="dv">1</span>st Qu.<span class="sc">:</span>    <span class="fl">0.0</span>  </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    Exec<span class="sc">-</span>managerial<span class="sc">:</span> <span class="dv">6019</span>   Other<span class="sc">-</span>relative<span class="sc">:</span> <span class="dv">1506</span>   Black             <span class="sc">:</span> <span class="dv">4675</span>                  Median <span class="sc">:</span>    <span class="fl">0.0</span>  </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    Adm<span class="sc">-</span>clerical   <span class="sc">:</span> <span class="dv">5603</span>   Own<span class="sc">-</span>child     <span class="sc">:</span> <span class="dv">7577</span>   Other             <span class="sc">:</span>  <span class="dv">403</span>                  Mean   <span class="sc">:</span>  <span class="fl">582.4</span>  </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    Sales          <span class="sc">:</span> <span class="dv">5470</span>   Unmarried     <span class="sc">:</span> <span class="dv">5118</span>   White             <span class="sc">:</span><span class="dv">41546</span>                  <span class="dv">3</span>rd Qu.<span class="sc">:</span>    <span class="fl">0.0</span>  </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    Other<span class="sc">-</span>service  <span class="sc">:</span> <span class="dv">4920</span>   Wife          <span class="sc">:</span> <span class="dv">2314</span>                                             Max.   <span class="sc">:</span><span class="fl">41310.0</span>  </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    (Other)        <span class="sc">:</span><span class="dv">14419</span>                                                                                     </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>     capital.loss     hours.per.week        native.country    income     </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    Min.   <span class="sc">:</span>   <span class="fl">0.00</span>   Min.   <span class="sc">:</span> <span class="fl">1.00</span>   United<span class="sc">-</span>States<span class="sc">:</span><span class="dv">43613</span>   <span class="sc">&lt;=</span><span class="dv">50</span>K<span class="sc">:</span><span class="dv">37155</span>  </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>st Qu.<span class="sc">:</span>   <span class="fl">0.00</span>   <span class="dv">1</span>st Qu.<span class="sc">:</span><span class="fl">40.00</span>   Mexico       <span class="sc">:</span>  <span class="dv">949</span>   <span class="sc">&gt;</span><span class="dv">50</span>K <span class="sc">:</span><span class="dv">11443</span>  </span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    Median <span class="sc">:</span>   <span class="fl">0.00</span>   Median <span class="sc">:</span><span class="fl">40.00</span>   ?            <span class="sc">:</span>  <span class="dv">847</span>                </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    Mean   <span class="sc">:</span>  <span class="fl">87.94</span>   Mean   <span class="sc">:</span><span class="fl">40.37</span>   Philippines  <span class="sc">:</span>  <span class="dv">292</span>                </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>rd Qu.<span class="sc">:</span>   <span class="fl">0.00</span>   <span class="dv">3</span>rd Qu.<span class="sc">:</span><span class="fl">45.00</span>   Germany      <span class="sc">:</span>  <span class="dv">206</span>                </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    Max.   <span class="sc">:</span><span class="fl">4356.00</span>   Max.   <span class="sc">:</span><span class="fl">99.00</span>   Puerto<span class="sc">-</span>Rico  <span class="sc">:</span>  <span class="dv">184</span>                </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>                                      (Other)      <span class="sc">:</span> <span class="dv">2507</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This summary provides a foundation for the next stages of data preparation: identifying missing values, detecting outliers, and encoding categorical features for modeling.</p>
<p>With a clear understanding of the dataset’s structure and variable types, we now begin the data preparation process. The first step is to detect and handle missing values, an essential task for ensuring the completeness and reliability of our analysis.</p>
</section><section id="handling-missing-values" class="level3" data-number="3.16.2"><h3 data-number="3.16.2" class="anchored" data-anchor-id="handling-missing-values">
<span class="header-section-number">3.16.2</span> Handling Missing Values</h3>
<p>A crucial early step in data preparation is identifying and resolving missing values. If left untreated, missing data can distort statistical summaries, reduce model accuracy, and bias conclusions.</p>
<p>The <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function shows that three variables, <code>workclass</code>, <code>occupation</code>, and <code>native.country</code>, contain missing entries. In this dataset, however, missing values are not coded as <code>NA</code>, but as the string <code>"?"</code>, a placeholder commonly used in public datasets such as those from the UCI Machine Learning Repository. Because R does not automatically recognize <code>"?"</code> as missing, we must recode it manually:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adult</span><span class="op">[</span><span class="va">adult</span> <span class="op">==</span> <span class="st">"?"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also apply <code><a href="https://rdrr.io/r/base/droplevels.html">droplevels()</a></code> to remove unused categories from factor variables. This step helps prevent issues in later steps such as encoding:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span><span class="op">(</span><span class="va">adult</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To visualize the extent of missingness, we use the <code><a href="https://naniar.njtierney.com/reference/gg_miss_var.html">gg_miss_var()</a></code> function from the <strong>naniar</strong> package. This function generates a bar chart showing the number and percentage of missing values per variable:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/njtierney/naniar">naniar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://naniar.njtierney.com/reference/gg_miss_var.html">gg_miss_var</a></span><span class="op">(</span><span class="va">adult</span>, show_pct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
<p>The resulting plot confirms that only three variables contain missing values: <code>workclass</code> with 2794 entries, <code>occupation</code> with 2804 entries, and <code>native.country</code> with 847 entries.</p>
<p>Since the proportion of missing values is small, less than 0.06% in each case, we choose to impute the missing values rather than remove rows, which could lead to information loss. To preserve each variable’s distribution, we use <em>random imputation</em>, which replaces missing entries by randomly sampling from observed (non-missing) values:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/Hmisc/">Hmisc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adult</span><span class="op">$</span><span class="va">workclass</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/impute.html">impute</a></span><span class="op">(</span><span class="va">adult</span><span class="op">$</span><span class="va">workclass</span>,      <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="va">adult</span><span class="op">$</span><span class="va">native.country</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/impute.html">impute</a></span><span class="op">(</span><span class="va">adult</span><span class="op">$</span><span class="va">native.country</span>, <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="va">adult</span><span class="op">$</span><span class="va">occupation</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Hmisc/man/impute.html">impute</a></span><span class="op">(</span><span class="va">adult</span><span class="op">$</span><span class="va">occupation</span>,     <span class="st">"random"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we recheck for missingness to confirm that the imputation succeeded:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://naniar.njtierney.com/reference/gg_miss_var.html">gg_miss_var</a></span><span class="op">(</span><span class="va">adult</span>, show_pct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
<p>The updated plot should confirm that all missing values have been addressed. With this step complete, we are ready to encode categorical variables and scale numerical features, two more critical tasks in preparing the dataset for modeling.</p>
</section><section id="encoding-categorical-variables" class="level3" data-number="3.16.3"><h3 data-number="3.16.3" class="anchored" data-anchor-id="encoding-categorical-variables">
<span class="header-section-number">3.16.3</span> Encoding Categorical Variables</h3>
<p>Categorical variables often contain many unique values, which can complicate modeling and lead to overfitting if not handled carefully. In the <em>adult</em> dataset, two features, <code>native.country</code> and <code>workclass</code>, have a relatively high number of categories. To simplify modeling while preserving interpretability, we group related categories into broader, more informative classes.</p>
<section id="grouping-native.country-by-region" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="grouping-native.country-by-region">Grouping <code>native.country</code> by Region</h4>
<p>The <code>native.country</code> variable includes 41 distinct countries. Modeling each one as a separate category could dilute predictive power and inflate the feature space. A more structured approach is to group countries by geographic region:</p>
<ul>
<li><p>Europe: England, France, Germany, Greece, Netherlands, Hungary, Ireland, Italy, Poland, Portugal, Scotland, Yugoslavia.</p></li>
<li><p>Asia: China, Hong Kong, India, Iran, Cambodia, Japan, Laos, Philippines, Vietnam, Taiwan, Thailand.</p></li>
<li><p>North America: Canada, United States, Puerto Rico.</p></li>
<li><p>South America: Colombia, Cuba, Dominican Republic, Ecuador, El Salvador, Guatemala, Haiti, Honduras, Mexico, Nicaragua, Outlying US territories, Peru, Jamaica, Trinidad and Tobago.</p></li>
<li><p>Other: Includes the ambiguous category <code>"South"</code>, which lacks clear documentation in the dataset. We treat it as a separate group.</p></li>
</ul>
<p>We use the <code><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse()</a></code> function from the <strong>forcats</strong> package to perform the reclassification:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/">forcats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Europe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"England"</span>, <span class="st">"France"</span>, <span class="st">"Germany"</span>, <span class="st">"Greece"</span>, <span class="st">"Holand-Netherlands"</span>, <span class="st">"Hungary"</span>, <span class="st">"Ireland"</span>, <span class="st">"Italy"</span>, <span class="st">"Poland"</span>, <span class="st">"Portugal"</span>, <span class="st">"Scotland"</span>, <span class="st">"Yugoslavia"</span><span class="op">)</span></span>
<span><span class="va">Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"China"</span>, <span class="st">"Hong"</span>, <span class="st">"India"</span>, <span class="st">"Iran"</span>, <span class="st">"Cambodia"</span>, <span class="st">"Japan"</span>, <span class="st">"Laos"</span>, <span class="st">"Philippines"</span>, <span class="st">"Vietnam"</span>, <span class="st">"Taiwan"</span>, <span class="st">"Thailand"</span><span class="op">)</span></span>
<span><span class="va">N.America</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Canada"</span>, <span class="st">"United-States"</span>, <span class="st">"Puerto-Rico"</span><span class="op">)</span></span>
<span><span class="va">S.America</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Columbia"</span>, <span class="st">"Cuba"</span>, <span class="st">"Dominican-Republic"</span>, <span class="st">"Ecuador"</span>, <span class="st">"El-Salvador"</span>, <span class="st">"Guatemala"</span>, <span class="st">"Haiti"</span>, <span class="st">"Honduras"</span>, <span class="st">"Mexico"</span>, <span class="st">"Nicaragua"</span>, <span class="st">"Outlying-US(Guam-USVI-etc)"</span>, <span class="st">"Peru"</span>, <span class="st">"Jamaica"</span>, <span class="st">"Trinadad&amp;Tobago"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">adult</span><span class="op">$</span><span class="va">native.country</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse</a></span><span class="op">(</span><span class="va">adult</span><span class="op">$</span><span class="va">native.country</span>,</span>
<span>  <span class="st">"Europe"</span>    <span class="op">=</span> <span class="va">Europe</span>,</span>
<span>  <span class="st">"Asia"</span>      <span class="op">=</span> <span class="va">Asia</span>,</span>
<span>  <span class="st">"N.America"</span> <span class="op">=</span> <span class="va">N.America</span>,</span>
<span>  <span class="st">"S.America"</span> <span class="op">=</span> <span class="va">S.America</span>,</span>
<span>  <span class="st">"Other"</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"South"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To verify the transformation:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(adult<span class="sc">$</span>native.country)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>        Asia N.America S.America    Europe     Other </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="dv">993</span>     <span class="dv">44747</span>      <span class="dv">1946</span>       <span class="dv">797</span>       <span class="dv">115</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This grouping reduces sparsity, enhances interpretability, and avoids overfitting caused by excessive fragmentation of categories.</p>
</section><section id="simplifying-workclass" class="level4 unnumbered"><h4 class="unnumbered anchored" data-anchor-id="simplifying-workclass">Simplifying <code>workclass</code>
</h4>
<p>The <code>workclass</code> variable categorizes employment types. Two of its levels, “Never-worked” and “Without-pay”, are rare and similar in nature, representing individuals outside formal employment. We consolidate these under a single label: <code>Unemployed</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">adult</span><span class="op">$</span><span class="va">workclass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse</a></span><span class="op">(</span><span class="va">adult</span><span class="op">$</span><span class="va">workclass</span>, <span class="st">"Unemployed"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Never-worked"</span>, <span class="st">"Without-pay"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To confirm the update:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(adult<span class="sc">$</span>workclass)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>          Gov Unemployed    Private   Self<span class="sc">-</span>emp </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="dv">6919</span>         <span class="dv">32</span>      <span class="dv">35851</span>       <span class="dv">5796</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By reducing the number of categories in <code>workclass</code> and <code>native.country</code>, we streamline the dataset while retaining interpretability. This prepares the data for modeling algorithms that are sensitive to high-cardinality categorical inputs.</p>
</section></section><section id="handling-outliers" class="level3" data-number="3.16.4"><h3 data-number="3.16.4" class="anchored" data-anchor-id="handling-outliers">
<span class="header-section-number">3.16.4</span> Handling Outliers</h3>
<p>Identifying and addressing outliers is an important part of data preparation. Extreme values can distort summary statistics and influence the performance of models, particularly those sensitive to the range of numeric features. In this section, we focus on the <code>capital.loss</code> variable from the <em>adult</em> dataset to examine whether outliers are present and how they should be handled.</p>
<p>We begin with a basic summary:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(adult<span class="sc">$</span>capital.loss)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>      Min. <span class="dv">1</span>st Qu.  Median    Mean <span class="dv">3</span>rd Qu.    Max. </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.00</span>    <span class="fl">0.00</span>    <span class="fl">0.00</span>   <span class="fl">87.94</span>    <span class="fl">0.00</span> <span class="fl">4356.00</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>From this output, we observe that the minimum value is 0, and the maximum is 4356. A majority of observations, over 75%, have a value of 0. The median, 0, is substantially lower than the mean, 87.94, indicating a right-skewed distribution influenced by high values.</p>
<p>To explore this further, we visualize the distribution using both a boxplot and a histogram:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">adult</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">capital.loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Boxplot of capital.loss"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">adult</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">capital.loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histogram of capital.loss"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-28-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
</div>
<p>The boxplot shows a strong positive skew, with several high values extending beyond the upper whisker. The histogram confirms that most individuals report zero capital loss, with a few concentrated peaks near 2,000 and 4,000.</p>
<p>To focus more closely on the nonzero values, we restrict our analysis to rows where <code>capital.loss &gt; 0</code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">subset_adult</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">adult</span>, <span class="va">capital.loss</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">subset_adult</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">capital.loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Boxplot of nonzero capital.loss"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">subset_adult</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">capital.loss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span>, color <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Histogram of nonzero capital.loss"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2" data-layout-align="center">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="3-Data-preparation_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="H"></p>
</figure>
</div>
</div>
</div>
</div>
<p>Among those with a nonzero capital loss, the majority of values are concentrated below 500. However, a small number of observations exceed 4,000. Despite their rarity, these high values appear to follow a relatively smooth and symmetric distribution, suggesting they reflect genuine variation in the data rather than data entry errors.</p>
<p>Given this context, we choose to retain the extreme values in <code>capital.loss</code>. They are likely to reflect meaningful differences across individuals and should not be removed without strong justification. If we later find that these values introduce problems for modeling, we may consider one of several strategies: applying a log or square-root transformation to reduce skewness, creating a binary variable to indicate whether a capital loss occurred, or using winsorization to cap extreme values at a defined threshold.</p>
<p>Understanding the structure of <code>capital.loss</code> also prepares us for handling the related variable <code>capital.gain</code>, which we explore next. For a hands-on example, see the guided exercise at the end of this chapter.</p>
</section></section><section id="chapter-summary-and-takeaways" class="level2" data-number="3.17"><h2 data-number="3.17" class="anchored" data-anchor-id="chapter-summary-and-takeaways">
<span class="header-section-number">3.17</span> Chapter Summary and Takeaways</h2>
<p>This chapter covered the essential steps of data preparation, showing how to transform raw data into a format suitable for analysis. Using the <em>diamonds</em> and <em>adult</em> datasets, we practiced identifying outliers, handling missing values, scaling numerical features, and encoding categorical variables.</p>
<p>We emphasized that data preparation is not just technical; it is driven by the structure and meaning of each feature. Outliers can distort results, missing values must be addressed carefully, and categorical variables require appropriate encoding. Scaling ensures fairness across features for many algorithms.</p>
<p>These techniques, though often overlooked, are crucial for building reliable and interpretable models. Clean, well-structured data forms the foundation of every successful data science project.</p>
<p>Next chapter, we move to exploratory data analysis, where we begin uncovering patterns and relationships that inform our modeling choices.</p>
</section><section id="sec-ch3-exercises" class="level2" data-number="3.18"><h2 data-number="3.18" class="anchored" data-anchor-id="sec-ch3-exercises">
<span class="header-section-number">3.18</span> Exercises</h2>
<p>This section includes exercises designed to deepen your understanding of data preparation. They cover conceptual questions, hands-on practice with the <em>diamonds</em> and <em>adult</em> datasets, and reflection on ethical and real-world issues. These exercises can be completed in R and build on the examples discussed in this chapter.</p>
<section id="understanding-data-types" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="understanding-data-types">Understanding Data Types</h3>
<ol type="1">
<li><p>Explain the difference between continuous and discrete numerical variables, and give a real-world example of each.</p></li>
<li><p>How do ordinal and nominal categorical variables differ? Provide one example for each type.</p></li>
<li><p>Use the <code><a href="https://rdrr.io/r/base/typeof.html">typeof()</a></code> and <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> functions in R to investigate how numerical and categorical variables are represented internally.</p></li>
<li><p>Why is it important to identify the correct data types before modeling?</p></li>
</ol></section><section id="working-with-the-diamonds-dataset" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="working-with-the-diamonds-dataset">Working with the Diamonds Dataset</h3>
<ol start="5" type="1">
<li><p>Use <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to inspect the <em>diamonds</em> dataset. What patterns or irregularities do you notice?</p></li>
<li><p>Classify the variables in the <em>diamonds</em> dataset as numerical, ordinal, or nominal.</p></li>
<li><p>Create histograms of <code>carat</code> and <code>price</code>. Describe their distributions and note any skewness or gaps.</p></li>
</ol></section><section id="detecting-and-treating-outliers" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="detecting-and-treating-outliers">Detecting and Treating Outliers</h3>
<ol start="8" type="1">
<li><p>Identify outliers in the <code>x</code> variable using boxplots and histograms. If outliers are found, apply a method to handle them as done for <code>y</code> in Section <a href="#sec-ch3-data-pre-outliers" class="quarto-xref"><span>3.4</span></a>.</p></li>
<li><p>Repeat the process for the <code>z</code> variable and comment on the results.</p></li>
<li><p>Examine the <code>depth</code> variable. What method would you use to detect and treat outliers in this case?</p></li>
<li><p>Discuss the pros and cons of removing outliers versus applying a transformation. Use examples from this chapter to support your answer.</p></li>
</ol></section><section id="encoding-categorical-variables-1" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="encoding-categorical-variables-1">Encoding Categorical Variables</h3>
<ol start="12" type="1">
<li><p>Show how to apply ordinal encoding to the <code>cut</code> variable in the <em>diamonds</em> dataset.</p></li>
<li><p>Demonstrate one-hot encoding for the <code>color</code> variable using appropriate R functions.</p></li>
<li><p>What problems can arise when applying ordinal encoding to a nominal variable?</p></li>
<li><p>Under what conditions is frequency encoding more appropriate than one-hot encoding?</p></li>
</ol></section><section id="exploring-the-adult-dataset" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="exploring-the-adult-dataset">Exploring the Adult Dataset</h3>
<ol start="16" type="1">
<li><p>Load the <em>adult</em> dataset from the <strong>liver</strong> package and classify its categorical variables as nominal or ordinal.</p></li>
<li><p>Compute the proportion of individuals earning more than $50K. What does this tell you about income distribution?</p></li>
<li><p>Generate a boxplot and histogram of <code>capital.gain</code>. What insights or anomalies can you identify?</p></li>
<li><p>Are there any outliers in <code>capital.gain</code>? If so, suggest how you would handle them.</p></li>
<li><p>Create a correlation matrix for the numerical variables. What do the correlations reveal about the relationships between features?</p></li>
</ol></section><section id="feature-engineering-and-scaling" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="feature-engineering-and-scaling">Feature Engineering and Scaling</h3>
<ol start="21" type="1">
<li><p>Use the <code><a href="https://rdrr.io/r/base/cut.html">cut()</a></code> function to group <code>age</code> into three categories: Young (<span class="math inline">\(\le 30\)</span>), Middle-aged (31–50), and Senior (<span class="math inline">\(&gt;50\)</span>). Name the new variable <code>Age_Group</code>.</p></li>
<li><p>Calculate the mean <code>capital.gain</code> for each <code>Age_Group</code>. What does this reveal?</p></li>
<li><p>Create a binary variable indicating whether an individual has nonzero <code>capital.gain</code>, and use it to create an exploratory plot.</p></li>
<li><p>Group the 16 education levels into broader categories using <code><a href="https://forcats.tidyverse.org/reference/fct_collapse.html">fct_collapse()</a></code>. Propose at least three meaningful groupings.</p></li>
<li><p>Define a new variable <code>net.capital</code> as the difference between <code>capital.gain</code> and <code>capital.loss</code>. Analyze its distribution using plots.</p></li>
<li><p>Apply Min-Max scaling to <code>age</code>, <code>capital.gain</code>, <code>capital.loss</code>, and <code>hours.per.week</code> using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and summarize the results.</p></li>
<li><p>Apply Z-score normalization to the same variables. How do the results compare to Min-Max scaling?</p></li>
</ol></section><section id="modeling-and-real-world-scenarios" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="modeling-and-real-world-scenarios">Modeling and Real-World Scenarios</h3>
<ol start="28" type="1">
<li><p>Build a logistic regression model predicting income (<code>&gt;50K</code>) using selected numerical predictors. Preprocess the data and interpret key coefficients.</p></li>
<li><p>If you were designing a credit scoring system, how would you encode features like <code>employment.type</code> or <code>loan.purpose</code>?</p></li>
<li><p>In a dataset where 25% of income values are missing, which imputation strategy would you use, and why?</p></li>
<li><p>A customer satisfaction variable includes five levels from “Very satisfied” to “Very dissatisfied.” Which encoding method is most appropriate, and why?</p></li>
<li><p>Would you handle outliers in patient temperature data differently than outliers in income data? Explain your reasoning.</p></li>
</ol></section><section id="ethics-and-reflection" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="ethics-and-reflection">Ethics and Reflection</h3>
<ol start="33" type="1">
<li><p>What ethical concerns might arise from dropping rows with missing data, particularly for underrepresented groups?</p></li>
<li><p>How can careless encoding of categorical variables lead to biased or unfair model outcomes? Provide an example.</p></li>
<li><p>A model performs well in training but poorly in production. How might decisions made during data preparation explain this discrepancy?</p></li>
<li><p>Reflect on a dataset you have worked with (or the <em>housePrice</em> dataset from the <strong>liver</strong> package). Which data preparation steps would you revise based on the techniques from this chapter?</p></li>
</ol>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/uncovering-data-science\.netlify\.app");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./2-Intro-data-science.html" class="pagination-link" aria-label="Foundations of Data Science and Machine Learning">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Foundations of Data Science and Machine Learning</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./4-Exploratory-data-analysis.html" class="pagination-link" aria-label="Exploratory Data Analysis">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Data Science Foundations and Machine Learning with R was written by <a href="https://www.uva.nl/profile/a.mohammadi"><span style="color:gray">Reza Mohammadi</span></a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/RezaMoammadi/Book-Data-Science/edit/main/3-Data-preparation.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/RezaMoammadi/Book-Data-Science/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>